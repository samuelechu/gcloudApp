<!DOCTYPE html>
<html>
<head>
    <title>
        Welcome

    </title>
    <meta name="google-signin-client_id"
    content="65587295914-kbl4e2chuddg9ml7d72f6opqhddl62fv.apps.googleusercontent.com">
    <link rel="stylesheet" href="https://bootswatch.com/darkly/bootstrap.min.css">
    <style media="screen">
        #logout{display:none}
    </style>


</head>
<body>
    <div id="my-signin2"></div>
    <script>

        function onSignIn(googleUser) {
            var id_token = googleUser.getAuthResponse().id_token;

            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=' + id_token);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.onload = function() {
              console.log('Signed in as: ' + xhr.responseText);
            };
            xhr.send('idtoken=' + id_token);

            var profile = googleUser.getBasicProfile();
            console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
            console.log('Name: ' + profile.getName());
            console.log('Image URL: ' + profile.getImageUrl());
            console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
            setElements(true);


            
        }

        // function onSuccess(googleUser) {
        //     console.log('Logged in as: ' + googleUser.getBasicProfile().getName());
            
        // }
        // function onFailure(error) {
        //     console.log(error);
        //     setElements(false);
        // }
        // function renderButton() {
        //     gapi.signin2.render('my-signin2', {
        //         'scope': 'profile email',
        //         'width': 240,
        //         'height': 50,
        //         'longtitle': true,
        //         'theme': 'dark',
        //         'onsuccess': onSuccess,
        //         'onfailure': onFailure
        //     });
        // }
</script>



<script>

    function setElements(isLoggedIn){
                if(isLoggedIn){
                    document.getElementById('gSignInButton').style.display = 'none'
                    document.getElementById('logout').style.display = 'block'

                    auth2 = gapi.auth2.init({
                        client_id: 'CLIENT_ID.apps.googleusercontent.com',
                        cookiepolicy: 'single_host_origin', /** Default value **/
                        scope: 'profile' });                /** Base scope **/
                    
                    var options = new gapi.auth2.SigninOptionsBuilder(
                        {'scope': 'email https://www.googleapis.com/auth/drive'});

                        googleUser = auth2.currentUser.get();
                        googleUser.grant(options).then(
                        function(success){
                          console.log(JSON.stringify({message: "success", value: success}));
                        },
                        function(fail){
                          alert(JSON.stringify({message: "fail", value: fail}));
                    });


                } else {
                    document.getElementById('gSignInButton').style.display = 'block'
                    document.getElementById('logout').style.display = 'none'
                }
     }

  function signOut() {
    var auth2 = gapi.auth2.getAuthInstance();
    auth2.signOut().then(function () {
      console.log('User signed out.');
    });
    setElements(false);
  }
</script>

<script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script>

<nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Graph Tester</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li class="active"><a href="index.html">GraphTest</a></li>
            </ul>

            <ul class = "nav navbar-nav navbar-right">
                <div id = "gSignInButton" class="g-signin2" data-onsuccess="onSignIn"></div>
                <li><a id = "logout" href="#" onclick="signOut();">Sign out</a></li>


            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>

<div class = "container">
    <h3 id = "heading">Log in to view info </h3>

    <div id = "profile"></div>
</div>

</body>
</html>
